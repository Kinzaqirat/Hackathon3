"""
OpenAI Agent implementation for {{SERVICE_DISPLAY_NAME}}
"""

import logging
import os
from typing import Dict, Any, Optional
import uuid
from datetime import datetime

logger = logging.getLogger(__name__)

class Agent:
    """
    AI Agent using OpenAI's agent framework
    """
    
    def __init__(self, service_name: str):
        """Initialize the agent"""
        self.service_name = service_name
        self.api_key = os.getenv("OPENAI_API_KEY")
        
        # TODO: Initialize OpenAI client
        # from openai import OpenAI
        # self.client = OpenAI(api_key=self.api_key)
        
        logger.info(f"Agent initialized: {service_name}")
    
    async def process_message(self, user_id: str, message: str, session_id: Optional[str] = None) -> Dict[str, Any]:
        """
        Process a user message and return agent response
        
        Args:
            user_id: ID of the user
            message: User message
            session_id: Optional session ID for context
            
        Returns:
            Dictionary with response and session information
        """
        
        if not session_id:
            session_id = str(uuid.uuid4())
        
        logger.info(f"Processing message for user {user_id}, session {session_id}")
        
        try:
            # TODO: Implement agent logic
            # 1. Build context from Dapr state store
            # 2. Call OpenAI API with prompts and tools
            # 3. Process response
            # 4. Store in Dapr state store
            # 5. Return response
            
            # Placeholder response
            response_text = f"[{{SERVICE_NAME}} Agent] Echo: {message}"
            
            return {
                "message": response_text,
                "session_id": session_id,
                "timestamp": datetime.utcnow().isoformat(),
                "user_id": user_id
            }
        
        except Exception as e:
            logger.error(f"Error processing message: {str(e)}")
            raise
    
    async def cleanup(self):
        """Cleanup resources"""
        logger.info("Cleaning up agent resources")
        # TODO: Add cleanup logic
        pass

# TODO: Implement specific agent tools and prompts
# Example structure:

# SYSTEM_PROMPT = """
# You are the {{SERVICE_DISPLAY_NAME}} for LearnFlow.
# Your role is to [TODO: describe role]
# 
# Guidelines:
# - Be helpful and educational
# - Provide clear explanations
# - Encourage learning
# """

# TOOLS = [
#     {
#         "name": "tool_name",
#         "description": "Tool description",
#         "parameters": {...}
#     }
# ]
